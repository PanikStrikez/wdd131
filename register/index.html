<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Camp Registration</title>

  <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
  <link rel="stylesheet" href="register.css">
</head>

<body>
<div class="testbox">
  <h1>Camp Registration</h1>

  <form id="campForm">
    <fieldset class="participants">
      <legend>Participant Information</legend>

      <section class="participant">
        <p>Participant 1</p>

        <div class="item">
          <label for="fname_1">First Name<span>*</span></label>
          <input id="fname_1" type="text" name="fname_1" required>
        </div>

        <div class="item activities">
          <label for="activity_1">Activity #<span>*</span></label>
          <input id="activity_1" type="text" name="activity_1">
        </div>

        <div class="item">
          <label for="fee_1">Fee ($)<span>*</span></label>
          <input id="fee_1" type="number" name="fee_1" min="0" step="1" value="0" required>
        </div>

        <div class="item">
          <label for="date_1">Desired Date<span>*</span></label>
          <input id="date_1" type="date" name="date_1">
        </div>

        <div class="item">
          <p>Grade</p>
          <select name="grade_1">
            <option disabled selected value=""></option>
            <option value="1">1st</option><option value="2">2nd</option>
            <option value="3">3rd</option><option value="4">4th</option>
            <option value="5">5th</option><option value="6">6th</option>
            <option value="7">7th</option><option value="8">8th</option>
            <option value="9">9th</option><option value="10">10th</option>
            <option value="11">11th</option><option value="12">12th</option>
          </select>
        </div>
  
      </section>

      <button type="button" id="add">Add Participant</button>
    </fieldset>


    <fieldset>
      <legend>Household / Adult Primary Contact</legend>
      <div class="columns">
      </div>
    </fieldset>


    <div id="feeBar">Total fees: $<span id="totalFee">0</span></div>
    <div class="btn-block">
      <button type="submit" id="submitButton">Submit</button>
    </div>
  </form>

  <section id="summary"></section>
</div>

<script>

const $$ = sel => Array.from(document.querySelectorAll(sel));
const byId = id => document.getElementById(id);


let counter = 1;
const tpl = document.querySelector('.participant');
const participantsWrap = document.querySelector('.participants');
const addBtn = byId('add');

addBtn.addEventListener('click', () => {
  counter++;
  const clone = tpl.cloneNode(true);
  clone.querySelector('p').textContent = `Participant ${counter}`;
  renameFields(clone, counter);
  injectRemoveButton(clone);
  participantsWrap.insertBefore(clone, addBtn);
});


function renameFields(block, num){
  $$('input,select', block).forEach(el => {
    const base = el.name.split('_')[0];   
    el.name = el.id = `${base}_${num}`;
    if(el.type==='number') el.value = 0;
  });
  $$('label', block).forEach(label=>{
    const base = label.htmlFor.split('_')[0];
    label.htmlFor = `${base}_${num}`;
  });
}

function injectRemoveButton(block){
  const btn = document.createElement('button');
  btn.type = 'button';
  btn.className = 'remove';
  btn.innerHTML = '×';
  btn.title = 'Remove this participant';
  btn.onclick = () => { block.remove(); calcTotal(); };
  block.appendChild(btn);
}

document.addEventListener('input', e=>{
  if(e.target.name?.startsWith('fee_')) calcTotal();
});
function calcTotal(){
  const total = $$('input[name^="fee_"]').reduce((s,el)=>s+Number(el.value||0),0);
  byId('totalFee').textContent = total;
}
calcTotal();

const campForm = byId('campForm');
campForm.addEventListener('submit', e=>{
  e.preventDefault();
  buildSummary();
  campForm.reset();
  counter = 1; 
  $$('section.participant').slice(1).forEach(p=>p.remove());
  calcTotal();
});

function buildSummary(){
  const out = [];
  $$('section.participant').forEach((sec,i)=>{
    const idx = i+1;
    const fname  = byId(`fname_${idx}`).value;
    const act    = byId(`activity_${idx}`).value;
    const fee    = byId(`fee_${idx}`).value;
    const date   = byId(`date_${idx}`).value;
    const grade  = byId(`grade_${idx}`)?.value || '';
    out.push(`<strong>${fname}</strong> — Activity ${act}, Fee $${fee}, Date ${date}, Grade ${grade}`);
  });
  const html = `
    <details open>
      <summary>Registration Summary (${out.length} participant${out.length>1?'s':''})</summary>
      <article>${out.join('<br>')}</article>
      <article style="margin-top:.75rem">Total paid: <strong>$${byId('totalFee').textContent}</strong></article>
    </details>`;
  byId('summary').innerHTML = html;
}
</script>
</body>
</html>